CREATE TABLE SINGER(
    SINGERID VARCHAR(5) NOT NULL PRIMARY KEY,
    SINGERNAME VARCHAR(50) NOT NULL
)

CREATE TABLE RECEIPT(
    RECEIPTNO VARCHAR(10) NOT NULL PRIMARY KEY,
    COSTUMERNAME VARCHAR(50) NOT NULL,
    RECEIPTDATE DATE NOT NULL
)


CREATE TABLE ALBUM(
    SINGERID VARCHAR(5) NOT NULL,
    ALBUMNO VARCHAR(5) NOT NULL PRIMARY KEY,
    ALBUMNAME VARCHAR(50) NOT NULL,
    RELEASEYEAR INTEGER NOT NULL,
    PRICE DECIMAL(10,2) NOT NULL,
    FOREIGN KEY(SINGERID) REFERENCES SINGER(SINGERID)
)


CREATE TABLE DETAILITEM(
    DETAILID VARCHAR(10) NOT NULL PRIMARY KEY,
    ALBUMNO VARCHAR(5) NOT NULL,
    RECEIPTNO VARCHAR(10) NOT NULL,
    AMOUNT INTEGER NOT NULL,
    TOTALPRICE DECIMAL(10,2) NOT NULL,
    FOREIGN KEY(ALBUMNO) REFERENCES ALBUM(ALBUMNO),
    FOREIGN KEY(RECEIPTNO) REFERENCES RECEIPT(RECEIPTNO)
)


INSERT INTO SINGER VALUES
('B01','ARIANA GRANDE'),
('I01','KAHITNA'),
('K01','BTOB')


INSERT INTO RECEIPT VALUES
('R0001','NATASHA MEIDYANI','2022-12-01'),
('R0002','HENDY AZMI','2022-12-02'),
('R0003','ATIKA FARAHDINA','2022-12-07')


INSERT INTO ALBUM VALUES
('B01','A01','THANK U,NEXT',2019,576000.00),
('B01','A02','POSITIONS',2020,615000.00),
('I01','A03','THE SIGNATURE COLLECTION',2020,460000.00),
('K01','A04','4U OUTSIDE',2021,535400.00),
('K01','A05','BE TOGETHER',2022,340000.00)

INSERT INTO DETAILITEM VALUES
('D0001','A01','R0001',4,2304000.00),
('D0002','A02','R0001',2,1230000.00),
('D0003','A05','R0001',5,1700000.00),
('D0004','A03','R0002',2,920000.00),
('D0005','A03','R0003',8,3680000.00)


-- NO 2

-- Menambahkan Alter Table
ALTER TABLE DETAILITEM 
ADD COLUMN "DISCOUNT%" INTEGER,
ADD COLUMN "NETPRICE" DECIMAL(15,2)

-- Mengisi data tabel baru
UPDATE DETAILITEM
SET "DISCOUNT%" = CASE
WHEN TOTALPRICE <= 2000000.00 THEN 10 
ELSE 25
END, 
"NETPRICE" = TOTALPRICE - (TOTALPRICE * "DISCOUNT%" / 100);


-- No 3
SELECT R.COSTUMERNAME,A.ALBUMNO,A.ALBUMNAME,S.SINGERNAME
FROM RECEIPT R
INNER JOIN  DETAILITEM D ON R.RECEIPTNO = D.RECEIPTNO 
INNER JOIN ALBUM A ON A.ALBUMNO = D.ALBUMNO 
INNER JOIN SINGER S ON S.SINGERID = A.SINGERID
WHERE R.RECEIPTDATE > '2022-12-02'

-- No 4 
